<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Third">
	<select id="getpayimage" resultType="record" parameterType="record">
		<![CDATA[
		SELECT
			TUS.ID,
			TUS.V_USER_ID,
			TAS.ID ACCOUNT_SHOW_ID,
			TBT.ID BOND_ID,
			TBT.V_WX_RECEIVABLES,
			TBT.V_ALI_RECEIVABLES,
			TPA.V_PAY_MODEL,
			TBT.V_COUNT_RECEIVABLES,
			TBT.V_SURPLUS_BOND,
			TPA.ID PAY_ID,
			TAS.V_ORDER_NUM,
			TAS.V_ACCOUNT_ID 
		FROM
			T_USER_SHOW TUS
			LEFT JOIN T_BOND_TODAY TBT ON TUS.V_USER_ID = TBT.V_USER_ID
			LEFT JOIN T_ACCOUNT_SHOW TAS ON TUS.V_USER_ID = TAS.V_USER_ID
			LEFT JOIN T_PAY_ACCOUNT TPA ON TAS.V_ACCOUNT_ID = TPA.ID
			LEFT JOIN T_ACCOUNT_COLLECTION TAC ON TAS.V_ACCOUNT_ID = TAC.V_ACCOUNT_ID
		]]>
		<where>
		<![CDATA[
			tus.V_IS_PAY ='Y' and (tbt.V_SURPLUS_BOND - tbt.V_LOCK_MONEY)  >= #{V_MONEY}
			and tas.V_PAY_NUM > 5 and  tpa.V_IS_MATCH = 'Y' and tpa.V_PAY_TYPE =#{V_PAY_TYPE} 
			and (tpa.V_PAY_TOTAL = #{V_MONEY} or tpa.V_PAY_TOTAL = '0.00') and tpa.V_IS_LOCK = 'N'
			AND DATE_FORMAT(DATE_ADD(tas.V_PAY_TIME,INTERVAL 20 MINUTE),'%Y-%m-%d %T') < DATE_FORMAT(now(),'%Y-%m-%d %T') 
		]]>
		</where>
		<![CDATA[
		order by tus.V_USER_LEVEL,tus.V_PAY_TIME,tas.V_PAY_TIME
		]]>
	</select>

	<select id="getpaytestimage" resultType="record" parameterType="record">
		<![CDATA[
			SELECT
				TUS.ID,
				TUS.V_USER_ID,
				TAS.ID ACCOUNT_SHOW_ID,
				TBT.ID BOND_ID,
				TBT.V_WX_RECEIVABLES,
				TBT.V_ALI_RECEIVABLES,
				TPA.V_PAY_MODEL,
				TBT.V_COUNT_RECEIVABLES,
				TBT.V_SURPLUS_BOND,
				TAS.V_ORDER_NUM,
				TAS.V_ACCOUNT_ID 
			FROM
				T_USER_SHOW TUS
				LEFT JOIN T_BOND_TODAY TBT ON TUS.V_USER_ID = TBT.V_USER_ID
				LEFT JOIN T_ACCOUNT_SHOW TAS ON TUS.V_USER_ID = TAS.V_USER_ID
				LEFT JOIN T_PAY_ACCOUNT TPA ON TAS.V_ACCOUNT_ID = TPA.ID
				LEFT JOIN T_ACCOUNT_COLLECTION TAC ON TAS.V_ACCOUNT_ID = TAC.V_ACCOUNT_ID
		]]>
		<where>
		<![CDATA[
			tus.V_IS_PAY ='Y' and (tbt.V_SURPLUS_BOND - tbt.V_LOCK_MONEY)  >= #{V_MONEY}
			and tas.V_PAY_NUM > 0 and  tpa.V_IS_MATCH = 'Y' and tpa.V_PAY_TYPE =#{V_PAY_TYPE} 
			and (tpa.V_PAY_TOTAL = #{V_MONEY} or tpa.V_PAY_TOTAL = '0.00') and tpa.V_IS_LOCK = 'N'
		]]>
			<if test="V_PAY_MODEL !=null and V_PAY_MODEL !=''">
				<![CDATA[AND tpa.V_PAY_MODEL = #{V_PAY_MODEL}]]>
			</if>
		</where>
		<![CDATA[
		order by tus.V_USER_LEVEL,tus.V_PAY_TIME,tas.V_PAY_TIME
		]]>
	</select>

	<select id="getOrderInfo" resultType="record" parameterType="record">
		<![CDATA[
			SELECT * FROM T_ORDER_TAB  
		]]>
		<where>
		<![CDATA[
			and V_ORDER_NO = #{V_ORDER_NO} and (V_STATUS = '1' or V_STATUS= '3')
			and V_BELONG_APP = #{V_APP_ID}
		]]>
		</where>
	</select>
</mapper>
